<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transwer - Assistente de IA para Reuni√µes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* === GLOBAL STYLES === */
        :root {
            --color-primary: #14b8a6;
            --color-secondary: #38bdf8;
            --color-accent: #8b5cf6;
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-background: #0f172a;
            --color-surface: #1e293b;
            --color-surface-light: #334155;
            --color-text: #e2e8f0;
            --color-text-muted: #94a3b8;
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, var(--color-background) 0%, #1e293b 100%);
            color: var(--color-text);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            line-height: 1.5;
            overflow: hidden;
        }

        /* === LOGO GRADIENT === */
        #logo {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary), var(--color-accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% 200%;
            animation: gradientShift 6s ease-in-out infinite;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* === GLASSMORPHISM PANELS === */
        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        /* === CONTROL BUTTON (REDESIGNED) === */
        .control-btn {
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            letter-spacing: 0.025em;
            outline: none;
            position: relative;
            transition: var(--transition);
            width: 80px;
            height: 80px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(20, 184, 166, 0.4);
        }

        .control-btn:active {
            transform: translateY(0);
        }

        .control-btn.processing {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.3);
            background: linear-gradient(135deg, var(--color-error), #dc2626);
        }

        .control-btn::before {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: inherit;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .control-btn:hover::before {
            opacity: 1;
        }

        /* === RESIZE HANDLES === */
        .resize-handle {
            background: var(--color-surface-light);
            cursor: ns-resize;
            height: 6px;
            position: relative;
            transition: var(--transition);
            z-index: 10;
        }

        .resize-handle:hover {
            background: var(--color-primary);
            height: 8px;
        }

        .resize-handle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
        }

        /* === PANEL CONTAINERS === */
        .panel-container {
            display: flex;
            flex-direction: column;
            min-height: 0;
            overflow: hidden;
            transition: var(--transition);
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: between;
            padding: 1rem 1.5rem 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .panel-title {
            font-size: 0.875rem;
            font-weight: 600;
            letter-spacing: 0.025em;
            text-transform: uppercase;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            scrollbar-width: thin;
            scrollbar-color: var(--color-surface-light) transparent;
        }

        .panel-content::-webkit-scrollbar {
            width: 6px;
        }

        .panel-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .panel-content::-webkit-scrollbar-thumb {
            background: var(--color-surface-light);
            border-radius: 3px;
        }

        .panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--color-primary);
        }

        /* === STATUS INDICATORS === */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .status-active {
            background: var(--color-success);
            box-shadow: 0 0 12px var(--color-success);
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        .status-inactive {
            background: var(--color-text-muted);
        }

        .status-error {
            background: var(--color-error);
            box-shadow: 0 0 12px var(--color-error);
        }

        /* === TEXT STYLING === */
        .text-transcription {
            font-size: 1.125rem;
            line-height: 1.6;
            color: var(--color-text);
        }

        .text-partial {
            opacity: 0.6;
            font-style: italic;
        }

        .text-translation {
            font-size: 1.25rem;
            line-height: 1.6;
            font-weight: 500;
            color: var(--color-text);
        }

        /* === SUGGESTION CARDS === */
        .suggestion-card {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: var(--border-radius);
            padding: 1rem;
            position: relative;
            transition: var(--transition);
            min-height: 120px;
            display: flex;
            flex-direction: column;
        }

        .suggestion-card:hover {
            border-color: rgba(139, 92, 246, 0.4);
            transform: translateY(-2px);
        }

        .suggestion-text {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--color-text-muted);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .suggestion-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 0.75rem;
        }

        .suggestion-btn {
            background: rgba(139, 92, 246, 0.2);
            border: none;
            border-radius: 50%;
            color: var(--color-accent);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            transition: var(--transition);
        }

        .suggestion-btn:hover {
            background: rgba(139, 92, 246, 0.4);
            transform: scale(1.1);
        }

        /* === QUICK LANGUAGE SELECTOR === */
        .lang-btn {
            background: var(--color-surface);
            border: 1px solid var(--color-surface-light);
            border-radius: 6px;
            color: var(--color-text-muted);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            padding: 0.5rem 0.75rem;
            transition: var(--transition);
        }

        .lang-btn:hover,
        .lang-btn.active {
            background: var(--color-primary);
            border-color: var(--color-primary);
            color: white;
            transform: translateY(-1px);
        }

        /* === NOTIFICATION SYSTEM === */
        .notification {
            background: var(--color-surface);
            border: 1px solid var(--color-surface-light);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: var(--color-text);
            font-weight: 500;
            padding: 1rem 1.5rem;
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            z-index: 1000;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: var(--color-success);
            background: rgba(16, 185, 129, 0.1);
        }

        .notification.error {
            border-color: var(--color-error);
            background: rgba(239, 68, 68, 0.1);
        }

        .notification.warning {
            border-color: var(--color-warning);
            background: rgba(245, 158, 11, 0.1);
        }

        /* === MODAL STYLES === */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            background: var(--color-surface);
            border: 1px solid var(--color-surface-light);
            border-radius: var(--border-radius);
            box-shadow: 0 20px 64px rgba(0, 0, 0, 0.5);
            max-height: 90vh;
            overflow: hidden;
        }

        /* === FORM ELEMENTS === */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            color: var(--color-text);
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .form-input {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--color-surface-light);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 0.875rem;
            padding: 0.75rem;
            transition: var(--transition);
            width: 100%;
        }

        .form-input:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
            outline: none;
        }

        .form-select {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--color-surface-light);
            border-radius: 8px;
            color: var(--color-text);
            font-size: 0.875rem;
            padding: 0.75rem;
            transition: var(--transition);
            width: 100%;
        }

        .form-select:focus {
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.1);
            outline: none;
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            .suggestions-grid {
                grid-template-columns: 1fr;
            }
            
            .control-btn {
                width: 60px;
                height: 60px;
            }
            
            .panel-content {
                padding: 1rem;
            }
        }

        /* === ANIMATIONS === */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- HEADER / CABE√áALHO -->
    <header class="flex-shrink-0 border-b border-white/10 bg-black/20 backdrop-blur-lg">
        <div class="container mx-auto flex items-center justify-between p-4">
            <!-- Logo & Title / Logo e T√≠tulo -->
            <div class="flex items-center space-x-3">
                <h1 id="logo" class="text-3xl font-bold tracking-tight">Transwer</h1>
                <span class="text-2xl">ü§ñ</span>
            </div>

            <!-- Status & Controls / Status e Controles -->
            <div class="flex items-center space-x-4">
                <!-- API Status / Status da API -->
                <div class="flex items-center space-x-2">
                    <div id="api-status-indicator" class="status-indicator status-inactive"></div>
                    <span id="api-status-text" class="text-sm font-medium text-gray-300">Pronto</span>
                </div>

                <!-- Settings Button / Bot√£o de Configura√ß√µes -->
                <button id="settings-btn" 
                        class="rounded-lg bg-white/5 p-2 text-gray-300 transition-colors hover:bg-white/10 hover:text-white"
                        title="Configura√ß√µes">
                    <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                              d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT / CONTE√öDO PRINCIPAL -->
    <main class="flex flex-1 flex-col overflow-hidden">
        <!-- Control Center / Centro de Controle -->
        <div class="flex-shrink-0 p-6">
            <div class="flex items-center justify-center">
                <button id="control-btn" class="control-btn" title="Iniciar/Parar Escuta">
                    <span id="control-icon">
                        <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                        </svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- Panels Container / Container dos Pain√©is -->
        <div id="panels-container" class="flex flex-1 flex-col space-y-0 overflow-hidden p-4 pt-0">
            
            <!-- TRANSCRIPTION PANEL / PAINEL DE TRANSCRI√á√ÉO -->
            <div id="transcription-panel" class="panel-container glass-panel" style="flex: 0 0 25%;">
                <div class="panel-header">
                    <h2 class="panel-title text-teal-400">
                        <span class="mr-2">üéôÔ∏è</span>
                        Transcri√ß√£o (EN-US)
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="clear-transcription-btn" 
                                class="rounded-md bg-teal-500/20 px-3 py-1 text-xs text-teal-300 transition-colors hover:bg-teal-500/40"
                                title="Limpar transcri√ß√£o">
                            Limpar
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="transcription-text" class="text-transcription">
                        <span id="final-text"></span>
                        <span id="partial-text" class="text-partial"></span>
                    </div>
                </div>
            </div>

            <!-- RESIZE HANDLE / AL√áA DE REDIMENSIONAMENTO -->
            <div class="resize-handle" data-target="transcription-panel" data-direction="vertical"></div>

            <!-- TRANSLATION PANEL / PAINEL DE TRADU√á√ÉO -->
            <div id="translation-panel" class="panel-container glass-panel" style="flex: 0 0 35%;">
                <div class="panel-header">
                    <h2 class="panel-title text-blue-400">
                        <span class="mr-2">üåê</span>
                        Tradu√ß√£o
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="force-translate-btn" 
                                class="rounded-md bg-blue-500/20 px-3 py-1 text-xs text-blue-300 transition-colors hover:bg-blue-500/40"
                                title="Re-traduzir todo o texto">
                            For√ßar Tradu√ß√£o
                        </button>
                        <button id="clear-translation-btn" 
                                class="rounded-md bg-blue-500/20 px-3 py-1 text-xs text-blue-300 transition-colors hover:bg-blue-500/40"
                                title="Limpar tradu√ß√£o">
                            Limpar
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="translation-text" class="text-translation"></div>
                </div>
            </div>

            <!-- RESIZE HANDLE / AL√áA DE REDIMENSIONAMENTO -->
            <div class="resize-handle" data-target="translation-panel" data-direction="vertical"></div>

            <!-- SUGGESTIONS PANEL / PAINEL DE SUGEST√ïES -->
            <div id="suggestions-panel" class="panel-container glass-panel" style="flex: 1;">
                <div class="panel-header">
                    <h2 class="panel-title text-purple-400">
                        <span class="mr-2">üí°</span>
                        Sugest√µes de Resposta
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button id="refresh-all-suggestions-btn" 
                                class="rounded-md bg-purple-500/20 px-3 py-1 text-xs text-purple-300 transition-colors hover:bg-purple-500/40"
                                title="Atualizar todas as sugest√µes">
                            Atualizar Todas
                        </button>
                    </div>
                </div>
                <div class="panel-content">
                    <div id="suggestions-grid" class="suggestions-grid grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3">
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- FOOTER / RODAP√â -->
    <footer class="flex-shrink-0 border-t border-white/10 bg-black/20 backdrop-blur-lg">
        <div class="container mx-auto flex flex-col items-center justify-between gap-4 p-4 md:flex-row">
            <!-- Copyright -->
            <div class="text-sm text-gray-400">
                Transwer ¬© 2025 - Assistente de IA para Reuni√µes
            </div>

            <!-- Quick Language Selection / Sele√ß√£o R√°pida de Idioma -->
            <div class="flex items-center space-x-3">
                <span class="text-sm font-medium text-gray-300">Traduzir Para:</span>
                <div id="lang-selector" class="flex space-x-1">
                    <button class="lang-btn" data-lang="pt-BR" title="Portugu√™s (Brasil)">PT-BR</button>
                    <button class="lang-btn" data-lang="en-US" title="English (United States)">EN-US</button>
                    <button class="lang-btn" data-lang="es" title="Espa√±ol">ES</button>
                    <button class="lang-btn" data-lang="ja" title="Êó•Êú¨Ë™û">JA</button>
                    <button class="lang-btn" data-lang="zh-CN" title="‰∏≠Êñá">ZH-CN</button>
                </div>
            </div>
        </div>
    </footer>

    <!-- SETTINGS MODAL / MODAL DE CONFIGURA√á√ïES -->
    <div id="settings-modal" class="modal-backdrop fixed inset-0 z-50 hidden items-center justify-center p-4">
        <div class="modal-content w-full max-w-4xl">
            <!-- Modal Header / Cabe√ßalho do Modal -->
            <div class="flex items-center justify-between border-b border-white/10 p-6">
                <h2 class="text-2xl font-bold text-white">
                    <span class="mr-2">‚öôÔ∏è</span>
                    Configura√ß√µes
                </h2>
                <button id="close-modal-btn" class="text-gray-400 hover:text-white">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Modal Content / Conte√∫do do Modal -->
            <div class="max-h-[60vh] overflow-y-auto p-6">
                <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
                    
                    <!-- Audio Settings / Configura√ß√µes de √Åudio -->
                    <div class="glass-panel p-4">
                        <h3 class="mb-4 text-lg font-semibold text-teal-400">üéôÔ∏è Configura√ß√µes de √Åudio</h3>
                        <div class="form-group">
                            <label class="form-label" for="audio-device-select">Dispositivo de Entrada</label>
                            <select id="audio-device-select" class="form-select">
                                <option value="">Carregando dispositivos...</option>
                            </select>
                        </div>
                    </div>

                    <!-- STT Engine Settings / Configura√ß√µes do Motor STT -->
                    <div class="glass-panel p-4">
                        <h3 class="mb-4 text-lg font-semibold text-blue-400">üéØ Reconhecimento de Fala</h3>
                        <div class="form-group">
                            <label class="form-label" for="stt-engine-select">Motor de Reconhecimento</label>
                            <select id="stt-engine-select" class="form-select">
                                <option value="vosk">Vosk (Local - R√°pido)</option>
                                <option value="fast_whisper">FastWhisper (Local - Preciso)</option>
                                <option value="google_stt_legacy">Google STT (Nuvem - Legado)</option>
                                <option value="google_chirp">Google Chirp (Nuvem - v2)</option>
                            </select>
                        </div>
                        
                        <!-- FastWhisper Options / Op√ß√µes do FastWhisper -->
                        <div id="fastwhisper-options" class="space-y-3 hidden">
                            <div class="form-group">
                                <label class="form-label" for="fastwhisper-model-select">Model Size</label>
                                <select id="fastwhisper-model-select" class="form-select">
                                    <option value="base">Base (Best Balance)</option>
                                    <option value="small">Small (Faster)</option>
                                    <option value="medium">Medium (More Accurate)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label" for="fastwhisper-compute-select">Compute Type</label>
                                <select id="fastwhisper-compute-select" class="form-select">
                                    <option value="int8">INT8 (Faster)</option>
                                    <option value="float16">Float16 (Better Quality)</option>
                                </select>
                            </div>
                        </div>

                        <!-- Google Region Option / Op√ß√£o de Regi√£o Google -->
                        <div id="google-region-option" class="form-group hidden">
                            <label class="form-label" for="google-region-input">Google Cloud Region</label>
                            <input id="google-region-input" type="text" class="form-input" placeholder="us-central1">
                        </div>
                    </div>

                    <!-- Translation Settings / Configura√ß√µes de Tradu√ß√£o -->
                    <div class="glass-panel p-4">
                        <h3 class="mb-4 text-lg font-semibold text-purple-400">üåê Tradu√ß√£o e IA</h3>
                        
                        <div class="form-group">
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="disable-features-cb" class="rounded">
                                <span class="form-label mb-0">Disable Translation & Suggestions</span>
                            </label>
                        </div>

                        <div id="translation-options" class="space-y-4">
                            <div class="form-group">
                                <label class="form-label" for="translation-engine-select">Translation Engine</label>
                                <select id="translation-engine-select" class="form-select">
                                    <option value="openai">OpenAI (GPT-4o-mini)</option>
                                    <option value="google_translate">Google Translate</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label" for="language-select">Target Language / Idioma de Destino</label>
                                <select id="language-select" class="form-select">
                                    <option value="pt-BR">Portugu√™s (Brasil)</option>
                                    <option value="en-US">English (United States)</option>
                                    <option value="es">Espa√±ol</option>
                                    <option value="ja">Êó•Êú¨Ë™û (Japanese)</option>
                                    <option value="zh-CN">‰∏≠Êñá (Chinese)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- API Credentials / Credenciais da API -->
                    <div class="glass-panel p-4">
                        <h3 class="mb-4 text-lg font-semibold text-yellow-400">üîë Credenciais da API</h3>
                        
                        <div class="form-group">
                            <label class="form-label" for="api-key-input">OpenAI API Key</label>
                            <input type="password" id="api-key-input" class="form-input" placeholder="sk-...">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="google-creds-input">Google Cloud JSON Credentials</label>
                            <textarea id="google-creds-input" rows="4" class="form-input" 
                                      placeholder="Paste your service account JSON here..."></textarea>
                        </div>
                    </div>

                </div>
            </div>

            <!-- Modal Footer / Rodap√© do Modal -->
            <div class="border-t border-white/10 p-6">
                <div class="flex justify-end space-x-4">
                    <button id="cancel-settings-btn" 
                            class="rounded-lg bg-gray-600 px-4 py-2 font-medium text-white transition-colors hover:bg-gray-500">
                        Cancelar
                    </button>
                    <button id="save-settings-btn" 
                            class="rounded-lg bg-teal-600 px-4 py-2 font-medium text-white transition-colors hover:bg-teal-500">
                        Salvar e Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION CONTAINER / CONTAINER DE NOTIFICA√á√ïES -->
    <div id="notification" class="notification"></div>

    <!-- SCRIPTS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.js"></script>
    <script>
        /**
         * Classe principal da aplica√ß√£o Transwer
         * Gerencia transcri√ß√£o de fala para texto e tradu√ß√£o em tempo real
         * @class TranswerApp
         */
        class TranswerApp {
            /**
             * Construtor da aplica√ß√£o - inicializa componentes e conex√µes
             * @constructor
             */
            constructor() {
                // Conex√£o WebSocket para comunica√ß√£o em tempo real com o servidor
                this.socket = io();
                // Flag que indica se o processamento de √°udio est√° ativo
                this.isProcessing = false;
                // Armazena as configura√ß√µes da aplica√ß√£o
                this.settings = {};
                // Buffer tempor√°rio para acumular texto transcrito
                this.transcriptionBuffer = '';
                // Buffer tempor√°rio para acumular texto traduzido
                this.translationBuffer = '';
                
                // Inicializa todos os componentes da aplica√ß√£o
                this.initializeElements();
                this.setupEventListeners();
                this.setupResizeHandles();
                this.setupSocketHandlers();
                
                console.log('ü§ñ Transwer inicializado');
            }

            /**
             * Inicializa refer√™ncias para todos os elementos DOM da interface
             * Organiza elementos por categoria para facilitar acesso posterior
             */
            initializeElements() {
                this.elements = {
                    // Controles principais da aplica√ß√£o
                    controlBtn: document.getElementById('control-btn'),
                    controlIcon: document.getElementById('control-icon'),
                    settingsBtn: document.getElementById('settings-btn'),
                    
                    // Indicadores de status da API
                    apiStatusIndicator: document.getElementById('api-status-indicator'),
                    apiStatusText: document.getElementById('api-status-text'),
                    
                    // Elementos de exibi√ß√£o de texto (transcri√ß√£o e tradu√ß√£o)
                    transcriptionText: document.getElementById('transcription-text'),
                    finalText: document.getElementById('final-text'),
                    partialText: document.getElementById('partial-text'),
                    translationText: document.getElementById('translation-text'),
                    suggestionsGrid: document.getElementById('suggestions-grid'),
                    
                    // Bot√µes de a√ß√£o para gerenciar conte√∫do
                    clearTranscriptionBtn: document.getElementById('clear-transcription-btn'),
                    forceTranslateBtn: document.getElementById('force-translate-btn'),
                    clearTranslationBtn: document.getElementById('clear-translation-btn'),
                    refreshAllSuggestionsBtn: document.getElementById('refresh-all-suggestions-btn'),
                    
                    // Seletor r√°pido de idiomas
                    langSelector: document.getElementById('lang-selector'),
                    
                    // Modal de configura√ß√µes e seus controles
                    settingsModal: document.getElementById('settings-modal'),
                    closeModalBtn: document.getElementById('close-modal-btn'),
                    cancelSettingsBtn: document.getElementById('cancel-settings-btn'),
                    saveSettingsBtn: document.getElementById('save-settings-btn'),
                    
                    // Campos de configura√ß√£o dentro do modal
                    audioDeviceSelect: document.getElementById('audio-device-select'),
                    sttEngineSelect: document.getElementById('stt-engine-select'),
                    translationEngineSelect: document.getElementById('translation-engine-select'),
                    languageSelect: document.getElementById('language-select'),
                    disableFeaturesCb: document.getElementById('disable-features-cb'),
                    apiKeyInput: document.getElementById('api-key-input'),
                    googleCredsInput: document.getElementById('google-creds-input'),
                    fastwhisperOptions: document.getElementById('fastwhisper-options'),
                    fastwhisperModelSelect: document.getElementById('fastwhisper-model-select'),
                    fastwhisperComputeSelect: document.getElementById('fastwhisper-compute-select'),
                    googleRegionOption: document.getElementById('google-region-option'),
                    googleRegionInput: document.getElementById('google-region-input'),
                    translationOptions: document.getElementById('translation-options'),
                    
                    // Sistema de notifica√ß√µes
                    notification: document.getElementById('notification')
                };
            }

            /**
             * Configura todos os event listeners da interface
             * Conecta elementos da UI √†s suas respectivas fun√ß√µes
             */
            setupEventListeners() {
                // Bot√£o principal para iniciar/parar processamento de √°udio
                this.elements.controlBtn.addEventListener('click', () => this.toggleProcessing());
                
                // Controles do modal de configura√ß√µes
                this.elements.settingsBtn.addEventListener('click', () => this.openSettings());
                this.elements.closeModalBtn.addEventListener('click', () => this.closeSettings());
                this.elements.cancelSettingsBtn.addEventListener('click', () => this.closeSettings());
                this.elements.saveSettingsBtn.addEventListener('click', () => this.saveSettings());
                
                // Bot√µes de a√ß√£o para gerenciar conte√∫do exibido
                this.elements.clearTranscriptionBtn.addEventListener('click', () => this.clearTranscription());
                this.elements.forceTranslateBtn.addEventListener('click', () => this.forceTranslate());
                this.elements.clearTranslationBtn.addEventListener('click', () => this.clearTranslation());
                this.elements.refreshAllSuggestionsBtn.addEventListener('click', () => this.refreshAllSuggestions());
                
                // Seletor r√°pido de idiomas - detecta cliques em bot√µes de idioma
                this.elements.langSelector.addEventListener('click', (e) => {
                    if (e.target.classList.contains('lang-btn')) {
                        this.changeLanguage(e.target.dataset.lang);
                    }
                });
                
                // Listeners para atualizar a UI quando configura√ß√µes mudam
                this.elements.sttEngineSelect.addEventListener('change', () => this.updateSettingsUI());
                this.elements.disableFeaturesCb.addEventListener('change', () => this.updateSettingsUI());
                
                // Atalho de teclado: Ctrl+Espa√ßo para iniciar/parar processamento
                document.addEventListener('keydown', (e) => {
                    if (e.key === ' ' && e.ctrlKey) {
                        e.preventDefault();
                        this.toggleProcessing();
                    }
                });
            }

            /**
             * Configura as al√ßas de redimensionamento dos pain√©is
             * Permite ao usu√°rio ajustar o tamanho dos pain√©is arrastando as bordas
             */
            setupResizeHandles() {
                const resizeHandles = document.querySelectorAll('.resize-handle');
                
                resizeHandles.forEach(handle => {
                    // Vari√°veis para controlar o estado do redimensionamento
                    let isResizing = false;
                    let startY = 0;
                    let startHeight = 0;
                    let targetPanel = null;
                    
                    // Inicia o redimensionamento quando o usu√°rio clica na al√ßa
                    handle.addEventListener('mousedown', (e) => {
                        e.preventDefault();
                        isResizing = true;
                        startY = e.clientY;
                        
                        // Identifica qual painel ser√° redimensionado
                        const targetId = handle.dataset.target;
                        targetPanel = document.getElementById(targetId);
                        startHeight = targetPanel.getBoundingClientRect().height;
                        
                        // Adiciona listeners globais para capturar movimento do mouse
                        document.addEventListener('mousemove', handleMouseMove);
                        document.addEventListener('mouseup', handleMouseUp);
                        
                        // Feedback visual durante o redimensionamento
                        handle.style.background = 'var(--color-primary)';
                        document.body.style.cursor = 'ns-resize';
                    });
                    
                    // Atualiza o tamanho do painel durante o movimento do mouse
                    const handleMouseMove = (e) => {
                        if (!isResizing || !targetPanel) return;
                        
                        // Calcula nova altura baseada no movimento do mouse
                        const deltaY = e.clientY - startY;
                        const newHeight = Math.max(100, startHeight + deltaY);
                        const totalHeight = document.getElementById('panels-container').offsetHeight;
                        const newFlexBasis = (newHeight / totalHeight) * 100;
                        
                        // Aplica limites m√≠nimos e m√°ximos (10% a 70%)
                        if (newFlexBasis >= 10 && newFlexBasis <= 70) {
                            targetPanel.style.flex = `0 0 ${newFlexBasis}%`;
                        }
                    };
                    
                    // Finaliza o redimensionamento e salva as prefer√™ncias
                    const handleMouseUp = () => {
                        isResizing = false;
                        targetPanel = null;
                        
                        // Remove listeners globais
                        document.removeEventListener('mousemove', handleMouseMove);
                        document.removeEventListener('mouseup', handleMouseUp);
                        
                        // Restaura apar√™ncia normal
                        handle.style.background = '';
                        document.body.style.cursor = '';
                        
                        // Salva o novo layout no localStorage
                        this.saveLayoutPreferences();
                    };
                });
            }

            /**
             * Configura os manipuladores de eventos WebSocket
             * Define como a aplica√ß√£o responde a mensagens do servidor
             */
            setupSocketHandlers() {
                // Conectado ao servidor - inicializa a aplica√ß√£o
                this.socket.on('connect', () => {
                    console.log('üîå Conectado ao servidor');
                    this.updateApiStatus('inactive', 'Pronto');
                    this.initializeSuggestions();
                });

                // Desconectado do servidor - mostra erro
                this.socket.on('disconnect', () => {
                    console.log('‚ö†Ô∏è Desconectado do servidor');
                    this.updateApiStatus('error', 'Desconectado');
                });

                // Configura√ß√µes carregadas do servidor
                this.socket.on('config_loaded', (config) => {
                    console.log('‚öôÔ∏è Configura√ß√µes carregadas', config);
                    this.loadSettings(config);
                });

                // Lista de dispositivos de √°udio dispon√≠veis
                this.socket.on('audio_devices_list', (devices) => {
                    this.populateAudioDevices(devices);
                });

                // Processamento de √°udio iniciado
                this.socket.on('processing_started', () => {
                    this.isProcessing = true;
                    this.updateControlButton();
                    this.updateApiStatus('active', 'Ouvindo...');
                    this.clearDisplays();
                });

                // Processamento de √°udio interrompido
                this.socket.on('processing_stopped', () => {
                    this.isProcessing = false;
                    this.updateControlButton();
                    this.updateApiStatus('inactive', 'Pausado');
                });

                // Novo texto transcrito recebido (STT - Speech to Text)
                this.socket.on('update_stt', (data) => {
                    this.updateTranscription(data);
                });

                // Nova tradu√ß√£o recebida
                this.socket.on('update_translation', (data) => {
                    this.updateTranslation(data);
                });

                // Comando para limpar √°rea de tradu√ß√£o
                this.socket.on('clear_translation', () => {
                    this.elements.translationText.textContent = '';
                    this.translationBuffer = '';
                });

                // Atualiza√ß√£o de uma sugest√£o espec√≠fica
                this.socket.on('update_one_suggestion', (data) => {
                    this.updateSuggestion(data);
                });

                // Notifica√ß√£o do servidor para exibir ao usu√°rio
                this.socket.on('notification', (data) => {
                    this.showNotification(data.message, data.status);
                });

                // Atualiza√ß√£o do status da API
                this.socket.on('api_status', (data) => {
                    this.updateApiStatus(data.status, data.message);
                });
            }

            /**
             * Alterna entre iniciar e parar o processamento de √°udio
             * Fun√ß√£o principal da aplica√ß√£o - controla a captura e processamento de fala
             */
            toggleProcessing() {
                // Desabilita o bot√£o temporariamente para evitar cliques m√∫ltiplos
                this.elements.controlBtn.disabled = true;
                
                if (this.isProcessing) {
                    // Se j√° est√° processando, para o processamento
                    this.socket.emit('stop_processing');
                } else {
                    // Se n√£o est√° processando, inicia com as configura√ß√µes atuais
                    const currentSettings = this.gatherCurrentSettings();
                    this.socket.emit('start_processing', currentSettings);
                }
            }

            /**
             * Coleta todas as configura√ß√µes atuais da interface
             * @returns {Object} Objeto com todas as configura√ß√µes para enviar ao servidor
             */
            gatherCurrentSettings() {
                return {
                    sttEngine: this.elements.sttEngineSelect.value,                    // Engine de transcri√ß√£o (Vosk, Whisper, etc.)
                    translationEngine: this.elements.translationEngineSelect.value,  // Engine de tradu√ß√£o (OpenAI, Google, etc.)
                    googleCreds: this.elements.googleCredsInput.value,               // Credenciais do Google Cloud
                    apiKey: this.elements.apiKeyInput.value,                         // Chave da API (OpenAI, etc.)
                    audioDevice: parseInt(this.elements.audioDeviceSelect.value, 10), // ID do dispositivo de √°udio
                    translationLang: this.elements.languageSelect.value,             // Idioma de destino da tradu√ß√£o
                    translationDisabled: this.elements.disableFeaturesCb.checked,    // Se tradu√ß√£o est√° desabilitada
                    suggestionsEnabled: !this.elements.disableFeaturesCb.checked,    // Se sugest√µes est√£o habilitadas
                    fastwhisperModel: this.elements.fastwhisperModelSelect.value,     // Modelo do FastWhisper
                    computeType: this.elements.fastwhisperComputeSelect.value,       // Tipo de computa√ß√£o (int8, float16, etc.)
                    googleRegion: this.elements.googleRegionInput.value              // Regi√£o do Google Cloud
                };
            }

            /**
             * Atualiza a apar√™ncia e comportamento do bot√£o de controle principal
             * Alterna entre √≠cone de play/pause baseado no estado atual
             */
            updateControlButton() {
                const btn = this.elements.controlBtn;
                const icon = this.elements.controlIcon;
                
                // Reabilita o bot√£o ap√≥s um breve delay para evitar spam de cliques
                setTimeout(() => {
                    btn.disabled = false;
                }, 500);
                
                if (this.isProcessing) {
                    // Estado: Processando - mostra √≠cone de stop
                    btn.classList.add('processing');
                    btn.title = 'Parar de Ouvir';
                    icon.innerHTML = `
                        <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd"/>
                        </svg>
                    `;
                } else {
                    // Estado: Parado - mostra √≠cone de play
                    btn.classList.remove('processing');
                    btn.title = 'Iniciar Escuta';
                    icon.innerHTML = `
                        <svg class="h-8 w-8" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"/>
                        </svg>
                    `;
                }
            }

            /**
             * Atualiza o indicador visual do status da API
             * @param {string} status - Status atual: 'active', 'inactive', 'error'
             * @param {string} message - Mensagem descritiva do status
             */
            updateApiStatus(status, message) {
                const indicator = this.elements.apiStatusIndicator;
                const text = this.elements.apiStatusText;
                
                // Remove classes anteriores e adiciona a classe do status atual
                indicator.className = 'status-indicator';
                indicator.classList.add(`status-${status}`);
                
                // Atualiza texto e tooltip
                text.textContent = message;
                indicator.title = `API Status: ${message}`;
            }

            /**
             * Atualiza o texto de transcri√ß√£o na interface
             * @param {Object} data - Dados da transcri√ß√£o com texto e flag is_partial
             */
            updateTranscription(data) {
                if (data.is_partial) {
                    // Texto parcial (ainda sendo processado) - exibe em √°rea tempor√°ria
                    this.elements.partialText.textContent = data.text;
                } else {
                    // Texto final - adiciona ao buffer permanente e limpa √°rea parcial
                    this.transcriptionBuffer += ` ${data.text}`;
                    this.elements.finalText.textContent = this.transcriptionBuffer;
                    this.elements.partialText.textContent = '';
                    
                    // Auto-scroll para mostrar o texto mais recente
                    this.elements.transcriptionText.scrollTop = this.elements.transcriptionText.scrollHeight;
                }
            }

            /**
             * Atualiza o texto de tradu√ß√£o na interface
             * @param {Object} data - Dados da tradu√ß√£o com o texto traduzido
             */
            updateTranslation(data) {
                // Adiciona novo texto traduzido ao buffer
                this.translationBuffer += ` ${data.text}`;
                this.elements.translationText.textContent = this.translationBuffer;
                
                // Auto-scroll para mostrar a tradu√ß√£o mais recente
                this.elements.translationText.scrollTop = this.elements.translationText.scrollHeight;
            }

            /**
             * Atualiza uma sugest√£o espec√≠fica na grade de sugest√µes
             * @param {Object} data - Dados da sugest√£o com √≠ndice e texto
             */
            updateSuggestion(data) {
                const suggestionCard = this.elements.suggestionsGrid.querySelector(`[data-index="${data.index}"]`);
                if (suggestionCard) {
                    const textElement = suggestionCard.querySelector('.suggestion-text');
                    textElement.textContent = data.suggestion;
                    // Muda cor para indicar que a sugest√£o foi atualizada
                    textElement.classList.remove('text-gray-400');
                    textElement.classList.add('text-white');
                }
            }

            /**
             * Exibe uma notifica√ß√£o tempor√°ria para o usu√°rio
             * @param {string} message - Mensagem a ser exibida
             * @param {string} type - Tipo da notifica√ß√£o: 'info', 'success', 'warning', 'error'
             */
            showNotification(message, type = 'info') {
                const notification = this.elements.notification;
                
                // Define o conte√∫do e estilo da notifica√ß√£o
                notification.textContent = message;
                notification.className = `notification ${type}`;
                notification.classList.add('show');
                
                // Remove a notifica√ß√£o automaticamente ap√≥s 4 segundos
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 4000);
            }

            /**
             * Inicializa a grade de sugest√µes com cards vazios
             * Cria 3 cards de sugest√£o padr√£o
             */
            initializeSuggestions() {
                // Limpa sugest√µes existentes
                this.elements.suggestionsGrid.innerHTML = '';
                
                // Cria 3 cards de sugest√£o
                for (let i = 0; i < 3; i++) {
                    const card = this.createSuggestionCard(i);
                    this.elements.suggestionsGrid.appendChild(card);
                }
            }

            /**
             * Cria um card de sugest√£o individual
             * @param {number} index - √çndice da sugest√£o (0, 1 ou 2)
             * @returns {HTMLElement} Elemento DOM do card criado
             */
            createSuggestionCard(index) {
                const card = document.createElement('div');
                card.className = 'suggestion-card fade-in';
                card.dataset.index = index;
                
                // Template HTML do card com texto placeholder e bot√£o de refresh
                card.innerHTML = `
                    <div class="suggestion-text text-gray-400">
                        Aguardando transcri√ß√£o...
                    </div>
                    <div class="suggestion-actions">
                        <button class="suggestion-btn" onclick="app.refreshSuggestion(${index})" title="Atualizar sugest√£o">
                            <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
                            </svg>
                        </button>
                    </div>
                `;
                
                return card;
            }

            /**
             * Limpa todo o conte√∫do da √°rea de transcri√ß√£o
             * Remove tanto texto final quanto parcial
             */
            clearTranscription() {
                this.transcriptionBuffer = '';
                this.elements.finalText.textContent = '';
                this.elements.partialText.textContent = '';
                this.showNotification('Transcri√ß√£o limpa', 'info');
            }

            /**
             * Limpa todo o conte√∫do da √°rea de tradu√ß√£o
             */
            clearTranslation() {
                this.translationBuffer = '';
                this.elements.translationText.textContent = '';
                this.showNotification('Tradu√ß√£o limpa', 'info');
            }

            /**
             * For√ßa a tradu√ß√£o do texto transcrito atual
             * √ötil quando a tradu√ß√£o autom√°tica n√£o funcionou
             */
            forceTranslate() {
                // Verifica se h√° texto para traduzir
                if (!this.transcriptionBuffer.trim()) {
                    this.showNotification('Nada para traduzir', 'warning');
                    return;
                }
                
                // Solicita tradu√ß√£o manual ao servidor
                const currentSettings = this.gatherCurrentSettings();
                this.socket.emit('force_translate', currentSettings);
                this.showNotification('For√ßando tradu√ß√£o...', 'info');
            }

            /**
             * Regenera uma sugest√£o espec√≠fica
             * @param {number} index - √çndice da sugest√£o a ser regenerada (0, 1 ou 2)
             */
            refreshSuggestion(index) {
                // Verifica se h√° conte√∫do para gerar sugest√µes
                if (!this.isProcessing && !this.transcriptionBuffer.trim()) {
                    this.showNotification('Inicie a escuta para obter sugest√µes', 'info');
                    return;
                }
                
                const currentSettings = this.gatherCurrentSettings();
                currentSettings.index = index;
                
                // Atualiza UI para mostrar estado de carregamento
                const card = this.elements.suggestionsGrid.querySelector(`[data-index="${index}"]`);
                const textElement = card.querySelector('.suggestion-text');
                textElement.textContent = 'Gerando...';
                textElement.className = 'suggestion-text text-gray-400';
                
                // Solicita nova sugest√£o ao servidor
                this.socket.emit('regenerate_suggestion', {
                    index: index,
                    config: currentSettings
                });
            }

            /**
             * Regenera todas as sugest√µes de uma vez
             * Chama refreshSuggestion para cada um dos 3 cards
             */
            refreshAllSuggestions() {
                for (let i = 0; i < 3; i++) {
                    this.refreshSuggestion(i);
                }
            }

            /**
             * Altera o idioma de destino da tradu√ß√£o
             * @param {string} langCode - C√≥digo do idioma (ex: 'pt-BR', 'en', 'es')
             */
            changeLanguage(langCode) {
                // Remove sele√ß√£o de todos os bot√µes de idioma
                const langButtons = this.elements.langSelector.querySelectorAll('.lang-btn');
                langButtons.forEach(btn => btn.classList.remove('active'));
                
                // Marca o bot√£o do idioma selecionado como ativo
                const activeBtn = this.elements.langSelector.querySelector(`[data-lang="${langCode}"]`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
                
                // Atualiza o select de idioma e salva configura√ß√µes
                this.elements.languageSelect.value = langCode;
                this.saveSettings();
                
                this.showNotification(`Idioma de tradu√ß√£o definido para ${langCode}`, 'success');
                
                // Se estiver processando, for√ßa nova tradu√ß√£o com o novo idioma
                if (this.isProcessing) {
                    setTimeout(() => this.forceTranslate(), 500);
                }
            }

            /**
             * Abre o modal de configura√ß√µes
             */
            openSettings() {
                this.elements.settingsModal.classList.remove('hidden');
                this.elements.settingsModal.classList.add('flex');
            }

            /**
             * Fecha o modal de configura√ß√µes sem salvar
             */
            closeSettings() {
                this.elements.settingsModal.classList.add('hidden');
                this.elements.settingsModal.classList.remove('flex');
            }

            /**
             * Carrega configura√ß√µes, priorizando configura√ß√µes locais sobre as do servidor
             * @param {Object} settings - Configura√ß√µes recebidas do servidor
             */
            loadSettings(settings) {
                // Tenta carregar configura√ß√µes salvas localmente
                const localSettings = localStorage.getItem('transwerSettings_v9');
                let settingsToApply = settings;
                
                // Prioriza configura√ß√µes locais se existirem
                if (localSettings) {
                    try {
                        settingsToApply = JSON.parse(localSettings);
                    } catch (e) {
                        console.error('Error parsing local settings:', e);
                    }
                }
                
                // Aplica as configura√ß√µes √† interface
                this.settings = settingsToApply;
                this.applySettingsToUI(settingsToApply);
            }

            /**
             * Aplica configura√ß√µes carregadas aos elementos da interface
             * @param {Object} settings - Objeto com todas as configura√ß√µes
             */
            applySettingsToUI(settings) {
                if (!settings) return;
                
                // Aplica valores aos campos de configura√ß√£o com fallbacks padr√£o
                this.elements.sttEngineSelect.value = settings.sttEngine || 'vosk';
                this.elements.translationEngineSelect.value = settings.translationEngine || 'openai';
                this.elements.googleCredsInput.value = settings.googleCreds || '';
                this.elements.apiKeyInput.value = settings.apiKey || '';
                this.elements.audioDeviceSelect.value = settings.audioDevice || 0;
                this.elements.languageSelect.value = settings.translationLang || 'pt-BR';
                this.elements.disableFeaturesCb.checked = settings.translationDisabled || false;
                this.elements.fastwhisperModelSelect.value = settings.fastwhisperModel || 'base';
                this.elements.fastwhisperComputeSelect.value = settings.computeType || 'int8';
                this.elements.googleRegionInput.value = settings.googleRegion || 'us-central1';
                
                // Atualiza sele√ß√£o visual do idioma no seletor r√°pido
                const activeBtn = this.elements.langSelector.querySelector(`[data-lang="${settings.translationLang || 'pt-BR'}"]`);
                if (activeBtn) {
                    this.elements.langSelector.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
                    activeBtn.classList.add('active');
                }
                
                // Atualiza visibilidade de se√ß√µes baseada nas configura√ß√µes
                this.updateSettingsUI();
            }

            /**
             * Atualiza a interface de configura√ß√µes baseada nas sele√ß√µes atuais
             * Mostra/esconde op√ß√µes espec√≠ficas de cada engine
             */
            updateSettingsUI() {
                const sttEngine = this.elements.sttEngineSelect.value;
                const isDisabled = this.elements.disableFeaturesCb.checked;
                
                // Mostra op√ß√µes do FastWhisper apenas quando selecionado
                this.elements.fastwhisperOptions.classList.toggle('hidden', sttEngine !== 'fast_whisper');
                // Mostra op√ß√µes de regi√£o do Google apenas quando Google Chirp for selecionado
                this.elements.googleRegionOption.classList.toggle('hidden', sttEngine !== 'google_chirp');
                // Esconde op√ß√µes de tradu√ß√£o quando recursos est√£o desabilitados
                this.elements.translationOptions.classList.toggle('hidden', isDisabled);
            }

            /**
             * Salva as configura√ß√µes atuais tanto localmente quanto no servidor
             */
            saveSettings() {
                const newSettings = this.gatherCurrentSettings();
                
                // Salva no localStorage para persist√™ncia local
                localStorage.setItem('transwerSettings_v9', JSON.stringify(newSettings));
                // Envia para o servidor
                this.socket.emit('save_settings', newSettings);
                // Atualiza configura√ß√µes na mem√≥ria
                this.settings = newSettings;
                
                this.showNotification('Configura√ß√µes salvas!', 'success');
                this.closeSettings();
            }

            /**
             * Popula a lista de dispositivos de √°udio dispon√≠veis
             * @param {Array} devices - Lista de dispositivos de √°udio do sistema
             */
            populateAudioDevices(devices) {
                this.elements.audioDeviceSelect.innerHTML = '';
                
                // Verifica se h√° dispositivos dispon√≠veis
                if (!devices || devices.length === 0) {
                    this.elements.audioDeviceSelect.innerHTML = '<option value="">Nenhum dispositivo encontrado</option>';
                    return;
                }
                
                // Cria op√ß√£o para cada dispositivo encontrado
                devices.forEach(device => {
                    const option = document.createElement('option');
                    option.value = device.id;
                    // Limita o nome do dispositivo a 50 caracteres para evitar overflow
                    option.textContent = `${device.id}: ${device.name.substring(0, 50)}${device.name.length > 50 ? '...' : ''}`;
                    this.elements.audioDeviceSelect.appendChild(option);
                });
                
                // Seleciona o dispositivo salvo nas configura√ß√µes
                if (this.settings.audioDevice !== undefined) {
                    this.elements.audioDeviceSelect.value = this.settings.audioDevice;
                }
            }

            /**
             * Limpa todas as √°reas de exibi√ß√£o quando inicia novo processamento
             * Reset completo da interface de conte√∫do
             */
            clearDisplays() {
                // Limpa buffers de texto
                this.transcriptionBuffer = '';
                this.translationBuffer = '';
                // Limpa elementos de texto na UI
                this.elements.finalText.textContent = '';
                this.elements.partialText.textContent = '';
                this.elements.translationText.textContent = '';
                // Reinicializa sugest√µes
                this.initializeSuggestions();
            }

            /**
             * Salva as prefer√™ncias de layout dos pain√©is no localStorage
             * Preserva o tamanho personalizado dos pain√©is entre sess√µes
             */
            saveLayoutPreferences() {
                const panels = {
                    transcription: document.getElementById('transcription-panel').style.flex,
                    translation: document.getElementById('translation-panel').style.flex,
                    suggestions: document.getElementById('suggestions-panel').style.flex
                };
                
                localStorage.setItem('transwerLayout', JSON.stringify(panels));
            }

            /**
             * Carrega as prefer√™ncias de layout salvas e aplica aos pain√©is
             * Restaura o tamanho personalizado dos pain√©is da sess√£o anterior
             */
            loadLayoutPreferences() {
                const saved = localStorage.getItem('transwerLayout');
                if (saved) {
                    try {
                        const panels = JSON.parse(saved);
                        // Aplica tamanhos salvos a cada painel se existirem
                        if (panels.transcription) document.getElementById('transcription-panel').style.flex = panels.transcription;
                        if (panels.translation) document.getElementById('translation-panel').style.flex = panels.translation;
                        if (panels.suggestions) document.getElementById('suggestions-panel').style.flex = panels.suggestions;
                    } catch (e) {
                        console.error('Error loading layout preferences:', e);
                    }
                }
            }
        }

        // Vari√°vel global para inst√¢ncia da aplica√ß√£o
        let app;
        
        /**
         * Inicializa√ß√£o da aplica√ß√£o quando o DOM estiver carregado
         * Cria inst√¢ncia principal e carrega prefer√™ncias salvas
         */
        document.addEventListener('DOMContentLoaded', () => {
            // Cria inst√¢ncia principal da aplica√ß√£o
            app = new TranswerApp();
            
            // Carrega prefer√™ncias de layout com pequeno delay para garantir renderiza√ß√£o
            setTimeout(() => {
                app.loadLayoutPreferences();
            }, 100);
            
            console.log('üöÄ Transwer pronto!');
        });

        // Disponibiliza a inst√¢ncia globalmente para callbacks inline
        window.app = app;
    </script>
</body>
</html>